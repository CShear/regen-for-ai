name: PR Template Check

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

jobs:
  validate-pr-body:
    name: Validate PR Body Format
    runs-on: ubuntu-latest
    steps:
      - name: Check required PR template sections
        uses: actions/github-script@v7
        with:
          script: |
            const body = context.payload.pull_request?.body || "";

            const requiredTokens = [
              "pr_context:",
              "change_type:",
              "scope:",
              "release_blocking:",
              "risk_level:",
              "breaking_change:",
              "db_migration:",
              "requires_follow_up:",
              "owner:",
              "approver:",
              "publisher:",
              "## Summary",
              "## Change Set",
              "## Test Plan",
              "## Risk and Rollback",
              "## Handoff Notes",
              "## Checklist"
            ];

            const missing = requiredTokens.filter((token) => !body.includes(token));

            if (missing.length > 0) {
              core.setFailed(
                "PR body is missing required template content: " + missing.join(", ")
              );
              return;
            }

            core.notice("PR template sections detected.");
